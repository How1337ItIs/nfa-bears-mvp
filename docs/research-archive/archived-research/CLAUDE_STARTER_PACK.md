# Claude's Liquid Light Starter Pack\n*Production-ready implementation following unified recommendations*\n\n## üéØ Architecture Overview\n\n**Single Engine of Record**: `webgl-fluid-enhanced` with strict fallback chain\n**Integration**: Next.js 15 + TypeScript + selective R3F post-processing\n**Performance**: Device-adaptive with automatic quality scaling\n**Audio**: Centralized single analyzer with unified physics mapping\n\n## üìÅ File Structure\n\n```\ncomponents/\n  LiquidLightBackground.tsx          # Main canvas component (engine of record)\nlib/\n  fluid/\n    config.ts                        # Authentic physics presets & device detection\n    thermal.ts                       # Convection currents & global motion\n  audio/\n    useAudioReactive.ts              # Single analyzer + unified mapping\n  post/\n    ThinFilmPass.tsx                 # Optional R3F post-processing\n```\n\n## üöÄ Quick Integration\n\n### Install Dependencies\n```bash\nnpm install webgl-fluid-enhanced @react-three/fiber @react-three/drei @react-three/postprocessing three postprocessing\n```\n\n### Basic Usage\n```tsx\n// app/layout.tsx or page.tsx\nimport LiquidLightBackground from '@/components/LiquidLightBackground';\n\nexport default function Layout({ children }: { children: React.ReactNode }) {\n  return (\n    <>\n      <LiquidLightBackground />\n      <main className=\"relative z-10\">\n        {children}\n      </main>\n    </>\n  );\n}\n```\n\n## ‚öôÔ∏è Configuration System\n\n### Authentic Physics Presets\n```typescript\n// lib/fluid/config.ts\nexport const AUTHENTIC_CONFIGS = {\n  high: {\n    SIM_RESOLUTION: 256,\n    DYE_RESOLUTION: 512,\n    VELOCITY_DISSIPATION: 0.4,    // Lava lamp viscosity\n    DENSITY_DISSIPATION: 0.92,    // Color persistence\n    CURL: 20,                     // Organic movement\n    PRESSURE_ITERATIONS: 25,      // Smooth boundaries\n    COLOR_PALETTE: [\n      '#ff0066',  // Electric magenta - 650nm\n      '#00ffcc',  // Cyan-turquoise - 485nm  \n      '#ffff33',  // Electric yellow - 580nm\n      '#ff6600'   // Orange-red - 620nm\n    ]\n  },\n  // medium & low tiers with performance optimizations\n};\n```\n\n### Device Capability Detection\n```typescript\nexport function detectDeviceCapabilities(): DeviceCapabilities {\n  // Automatic WebGL support, texture size, memory detection\n  // Returns: { webgl, webgl2, maxTextureSize, deviceMemory, mobile, tier }\n}\n```\n\n### Audio-to-Physics Mapping (Single Source of Truth)\n```typescript\nexport const AUDIO_PHYSICS_MAPPING = {\n  SPLAT_FORCE: { MIN: 8, MAX: 23, BASE: 5 },        // Bass -> splat intensity\n  THERMAL_RATE: { MIN: 2, MAX: 8, BASE: 3 },        // Mids -> convection rate\n  COLOR_PHASE: { MIN: 0, MAX: Math.PI * 2, BASE: 0 }, // Treble -> color shift\n  GLOBAL_INTENSITY: { MIN: 0.4, MAX: 1.0, BASE: 0.6 } // Volume -> overall strength\n};\n```\n\n## üéµ Audio Reactivity\n\n### Centralized Audio Hook\n```tsx\n// Single analyzer for entire application\nconst { audioData, physicsParams } = useAudioReactive();\n\n// Returns:\n// audioData: { bass, mids, treble, volume, beatDetected, spectralData }\n// physicsParams: { splatForce, thermalRate, colorPhase, globalIntensity }\n```\n\n### Authentic Audio Mapping\n- **Bass (0-4 freq bins)** ‚Üí Splat force & oil thickness\n- **Mids (4-16 freq bins)** ‚Üí Flow velocity & thermal convection rate  \n- **Treble (16-64 freq bins)** ‚Üí Surface iridescence & color phase rotation\n- **Volume (all bins)** ‚Üí Overall intensity multiplier\n\n### Beat Detection\n- Adaptive threshold based on recent activity\n- 250ms minimum interval between beats\n- Tempo estimation from beat history\n- Fallback to simulated audio when microphone unavailable\n\n## üå°Ô∏è Authentic Physics\n\n### Thermal Convection\n```typescript\n// Periodic upward splats from bottom 20% of canvas\n// 3-5 second intervals with audio reactivity\n// Warm orange-yellow colors for thermal currents\nsetupThermalCurrents(fluidInstance, canvas, physicsParams);\n```\n\n### Global Motion\n```typescript\n// Subtle circular rotation to prevent digital stillness  \n// Low amplitude, slow progression\n// Neutral colors for background motion\nsetupGlobalMotion(fluidInstance, canvas);\n```\n\n### Beat-Triggered Effects\n```typescript\n// Radial burst patterns on beat detection\n// Force intensity based on bass levels\n// Bright, saturated colors for impact\naddBeatEffect(fluidInstance, canvas, audioData);\n```\n\n## ‚ö° Performance Management\n\n### Automatic Quality Adjustment\n```typescript\n// FPS monitoring every 60 frames\nif (fps < 25) stepDownTier();  // 2+ seconds below threshold\nif (fps > 50) stepUpTier();    // 3+ seconds above threshold\n```\n\n### Device Tier Optimization\n- **High**: Desktop with good GPU (60fps target)\n- **Medium**: Modern mobile/tablet (30fps target)\n- **Low**: Limited devices (20fps target)\n\n### Memory Management\n- <50MB VRAM usage target\n- Automatic cleanup on route changes\n- WebGL context loss handling\n- Stream cleanup on component unmount\n\n## üé® Post-Processing (Optional)\n\n### Thin-Film Interference\n```tsx\n// Only on high/medium performance tiers\n<AuthenticThinFilmEffect \n  audioParams={physicsParams} \n  deviceTier={capabilities.tier}\n/>\n```\n\n### Authentic Color Physics\n- Wavelength-to-RGB conversion (380-750nm spectrum)\n- Real refractive indices (oil: 1.5, water: 1.33)\n- Optical path difference calculations\n- Multiple interference orders (m=1,2,3)\n\n## üîß Development Features\n\n### Debug HUD (Development Only)\n```tsx\n// Displays in top-right corner when NODE_ENV === 'development'\n<div className=\"fixed top-4 right-4 z-50\">\n  FPS: {fps} | Tier: {currentTier} | Audio: Bass {bass.toFixed(2)}\n  WebGL: {webgl2 ? 'v2' : 'v1'} | Memory: {deviceMemory}GB\n</div>\n```\n\n### Console Logging\n- Fluid initialization status\n- Performance tier changes\n- Audio permission status\n- WebGL context events\n- Quality adjustment notifications\n\n## üö¶ Fallback Strategy\n\n### Strict Fallback Chain\n1. **V3**: WebGL Fluid + Thin-Film Post\n2. **V2**: WebGL Fluid Only  \n3. **V1**: CSS Gradient Pulse (final fallback)\n\n### Error Handling\n- WebGL context lost ‚Üí CSS fallback\n- Shader compilation failure ‚Üí Disable post-processing\n- Performance degradation ‚Üí Auto quality reduction\n- Microphone denied ‚Üí Simulated audio data\n\n## ‚úÖ Production Checklist\n\n### Performance Targets\n- [ ] Desktop: 60fps @ 1080p with full effects\n- [ ] Mobile: 30fps @ native resolution \n- [ ] Low-end: 20fps with basic fluid only\n- [ ] Memory: <50MB VRAM usage\n\n### Functionality Tests\n- [ ] Automatic device detection\n- [ ] Quality tier adjustment\n- [ ] Audio reactivity (with and without microphone)\n- [ ] Beat detection and tempo estimation\n- [ ] Thermal convection and global motion\n- [ ] WebGL fallback to CSS\n- [ ] Clean component mounting/unmounting\n\n### Integration Verification\n- [ ] No pointer-events interference with UI\n- [ ] Proper z-index layering\n- [ ] Responsive canvas resizing\n- [ ] Route change cleanup\n- [ ] Production build compatibility\n\n## üéØ Usage Examples\n\n### Basic Background\n```tsx\n// Minimal integration - just add to layout\n<LiquidLightBackground />\n```\n\n### With Post-Processing\n```tsx\n// Enhanced version with thin-film effects\nconst { physicsParams } = useAudioReactive();\nconst capabilities = detectDeviceCapabilities();\n\n<>\n  <LiquidLightBackground />\n  <AuthenticThinFilmEffect \n    audioParams={physicsParams} \n    deviceTier={capabilities.tier}\n  />\n</>\n```\n\n### Custom Audio Mapping\n```tsx\n// Use individual audio components\nconst { bass, mids, treble } = useAudioReactive().audioData;\nconst { beatDetected, tempo } = useBeatDetection();\n\n// Custom visual reactions based on audio data\n```\n\n## üî¨ Technical Specifications\n\n### Audio Analysis\n- **FFT Size**: 256 (128 frequency bins)\n- **Smoothing**: 0.8 temporal smoothing constant\n- **Range**: -90dB to -10dB\n- **Sample Rate**: ~60fps analysis loop\n\n### Fluid Physics\n- **Simulation**: Navier-Stokes equations via webgl-fluid-enhanced\n- **Resolution**: 128-256 simulation, 256-512 dye (tier-dependent)\n- **Viscosity**: 0.4-0.5 velocity dissipation (lava lamp feel)\n- **Persistence**: 0.9-0.92 density dissipation (color longevity)\n\n### Rendering\n- **Blending**: Screen blend mode at 0.8 opacity\n- **Canvas**: Full viewport, pointer-events: none\n- **Context**: WebGL 1.0/2.0 with high-performance preference\n- **Fallback**: CSS gradient with 4s pulse animation\n\n---\n\n**This starter pack provides everything needed to deploy authentic 60s liquid light visuals as your brand's distinctive visual identity, with production-ready performance and device compatibility.**\n"